(function(){var e,r,n,t,i,o,a,l,m,u,c,f,v,h,g,d,p,C,s;C={main_vertex:"attribute highp vec3 position;\nattribute highp vec2 texCoord;\nattribute highp vec3 normal;\n\nuniform highp mat4 modelViewMatrix;\nuniform highp mat4 campProj;\nuniform highp mat4 normalMatrix;\n\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 directionalVector;\n\nvarying highp vec2 vTextureCoord;\nvarying highp vec3 vLighting;\n\nvoid main(void) {\n    gl_Position = campProj * modelViewMatrix * vec4(position, 1);\n\n    // apply lighting effect\n    highp vec4 transformedNormal = normalMatrix * vec4(normal, 1.0);\n    highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);\n\n    vLighting = ambientColor + (directionalColor * directional);\n    vTextureCoord = texCoord;\n}",main_fragment:"varying highp vec2 vTextureCoord;\nvarying highp vec3 vLighting;\n\nuniform sampler2D uSampler;\n\nvoid main(void) {\n    mediump vec4 texelColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n\n    gl_FragColor = vec4(texelColor.rgb * vLighting, 1.0);\n}"},t=null,i=null,n=new Cafe.Matrix4,h=new Cafe.Matrix4,v=[],s=null,e=new Cafe.Color(.1,.1,.1),a=vec3.fromValues(.5,1,1),l=new Cafe.DirectionalLight(new Cafe.Color(.8,1,.8),vec3.normalize(a,a)),g=null,m=3e3,o=Date.now(),f=function(e){return s=new Cafe.Texture(e.gl,"/resources/images/water512-e466fd93.jpg")},u=function(e){var r,n,t,i,o,a,l,m,u,c,f;for(t=10,a=(-t+1)/2,u=-20,i=.25,r=Cafe.Primitives.Cube.create(i),f=[],o=c=0;t>=0?t>c:c>t;o=t>=0?++c:--c)f.push(function(){var i,c;for(c=[],l=i=0;t>=0?t>i:i>t;l=t>=0?++i:--i)c.push(function(){var i,c;for(c=[],m=i=0;t>=0?t>i:i>t;m=t>=0?++i:--i)n=Cafe.Mesh.create(e,r),n.translate([a+l,a+o,u+m]),c.push(v.push(n));return c}());return c}());return f},c=function(e){var r;return r=new Cafe.WebGlCompiler(e.gl,C),g=r.createProgramWithShaders("main_vertex","main_fragment")},r=function(){var e,r,n,t,i,a,l,u;for(i=Date.now(),r=i-o,o=i,n=r/m,e=2*Math.PI*n,u=[],a=0,l=v.length;l>a;a++)t=v[a],u.push(t.rotate(e,[0,1,1]));return u},d=function(e,r){var t,i,o,a;for(e.clearBuffer(Cafe.Color.WHITE),n.perspective(Math.PI/3.5,r.width/r.height,1,1e4),g.matrix4("campProj",n),g.bindTexture("uSampler",s),a=[],i=0,o=v.length;o>i;i++)t=v[i],h.set(t.modelMatrix).invert().transpose(),g.matrix4("modelViewMatrix",t.modelMatrix),g.matrix4("normalMatrix",h),a.push(g.render(t));return a},p=function(e,n){return requestAnimationFrame(function(){return p(e,n)}),d(e,n),r()},this.main=function(){return t=document.getElementById("webglcanvas"),i=new Cafe.Context(t),f(i),c(i),u(i),i.useProgram(g),g.uniform3f("ambientColor",e),g.uniform3f("directionalColor",l.color),g.uniform3fv("directionalVector",l.direction),p(i,t)}}).call(this);