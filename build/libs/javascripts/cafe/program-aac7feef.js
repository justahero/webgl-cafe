(function(){namespace("Cafe",function(t){return t.Program=function(){function t(t,r,i){this.gl=t,this.vertexShader=r,this.fragmentShader=i,this.program=null,this._attributesMap=null,this._uniformsMap=null,this._link(this.gl)}return t.prototype.render=function(t){return this._bindMesh(t),t.render(this.gl,t.indexBuffer.size)},t.prototype.matrix3=function(t,r){var i;return i=this.uniformLocation(t),this.gl.uniformMatrix3fv(i,!1,r.values)},t.prototype.matrix4=function(t,r){var i;return i=this.uniformLocation(t),this.gl.uniformMatrix4fv(i,!1,r.values)},t.prototype.vector3=function(t,r){var i;return i=this.uniformLocation(t),this.gl.uniform3fv(i,r.values)},t.prototype.uniform3f=function(t,r){var i;return i=this.uniformLocation(t),this.gl.uniform3f(i,r.red,r.green,r.blue)},t.prototype.uniform3fv=function(t,r){var i;return i=this.uniformLocation(t),this.gl.uniform3fv(i,r)},t.prototype.getAttribLocation=function(t){var r;if(r=this._attributesMap[t],-1===r)throw"Could not getAttribLocation for "+t;return r},t.prototype.uniformLocation=function(t){var r;if(r=this._uniformsMap[t],!r)throw"Could not getUniformLocation for "+t;return r},t.prototype.numAttributes=function(){return this._attributesMap.length},t.prototype.numUniforms=function(){return this._uniformsMap.length},t.prototype._bindMesh=function(t){var r,i,e,o,n,a;for(n=t.vertexBuffers,e=0,o=n.length;o>e;e++)a=n[e],i=a.name,r=a.buffer,this._bindVertexBuffer(i,r);return t.indexBuffer?this._bindIndexBuffer(t.indexBuffer):void 0},t.prototype._bindVertexBuffer=function(t,r){var i;return i=this.getAttribLocation(t),this.gl.enableVertexAttribArray(i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r.buffer),this.gl.vertexAttribPointer(i,r.itemSize,this.gl.FLOAT,!1,0,0)},t.prototype._bindIndexBuffer=function(t){return this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t.buffer)},t.prototype.bindTexture=function(t,r){var i;return i=this.uniformLocation(t),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(r.type,r.texture),this.gl.uniform1i(i,0)},t.prototype._link=function(t){var r;if(this.program=t.createProgram(),t.attachShader(this.program,this.vertexShader.shader),t.attachShader(this.program,this.fragmentShader.shader),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))throw r=t.getProgramInfoLog(this.program),"Could not compile program, error: "+r;return this._attributesMap=this._findActiveAttribsMap(t),this._uniformsMap=this._findActiveUniformsMap(t),this.program},t.prototype._findActiveAttribsMap=function(t){var r,i,e,o,n;for(o={},e=this._getNumActiveAttributes(t),r=n=0;e>=0?e>n:n>e;r=e>=0?++n:--n)i=t.getActiveAttrib(this.program,r),o[i.name]=t.getAttribLocation(this.program,i.name);return o},t.prototype._findActiveUniformsMap=function(t){var r,i,e,o,n;for(o={},e=this._getNumActiveUniforms(t),r=n=0;e>=0?e>n:n>e;r=e>=0?++n:--n)i=t.getActiveUniform(this.program,r),o[i.name]=t.getUniformLocation(this.program,i.name);return o},t.prototype._getNumActiveAttributes=function(t){return t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES)},t.prototype._getNumActiveUniforms=function(t){return t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS)},t}()})}).call(this);